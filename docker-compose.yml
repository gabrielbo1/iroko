version: '3.4'

networks:
  irokonetwork:

x-default-config: &defaultconf
  networks:
    - irokonetwork

services:
  #TRAEFICK E CONSUL
  consul:
    image: consul:1.5.3
    command: consul agent -server -dev -client=0.0.0.0 -ui -bootstrap -log-level warn
    ports:
     - "8500:8500"
    <<: *defaultconf
  
  reverse-proxy:
    image: traefik:v1.7-alpine
    command: traefik --consulcatalog.endpoint=consul:8500 --api=true --docker
    ports:
      - 80:80
      - 443:443
      - 8080:8080
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./traefik.toml:/etc/traefik/traefik.toml:rw
    <<: *defaultconf


  iroko:
    image: gabrielbo1/iroko:latest
    environment:
      - TZ=GMT-3
      - CONSUL_ACTIVE=true
      - CONSUL_ADDRESS=consul
    <<: *defaultconf

